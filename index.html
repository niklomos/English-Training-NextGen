<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <title>Login / Register - Vocabulary Trainer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      :root {
        --primary: #2563eb;
        --primary-soft: #dbeafe;
        --accent: #06b6d4;
        --danger: #ef4444;
        --muted: #6b7280;
        --card-bg: rgba(255, 255, 255, 0.96);
        --card-border: rgba(148, 163, 184, 0.5);
        --radius-lg: 20px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: Inter, system-ui, -apple-system, "Segoe UI", sans-serif;
        min-height: 100vh;
        margin: 0;
        padding: 1.8rem;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #0f172a;
        background:
          radial-gradient(circle at 0% 0%, rgba(59, 130, 246, 0.2), transparent 55%),
          radial-gradient(circle at 100% 100%, rgba(45, 212, 191, 0.25), transparent 55%),
          linear-gradient(135deg, #eff6ff, #ecfdf5);
      }

      /* layer ‡πÄ‡∏ö‡∏•‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÅ‡∏ö‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏´‡∏ç‡πà */
      .auth-shell {
        position: relative;
        width: 100%;
        max-width: 960px;
      }

      .auth-shell-bg {
        position: absolute;
        inset: -40px -60px;
        background: radial-gradient(
            circle at top left,
            rgba(129, 140, 248, 0.18),
            transparent 55%
          ),
          radial-gradient(
            circle at bottom right,
            rgba(45, 212, 191, 0.24),
            transparent 55%
          );
        filter: blur(18px);
        opacity: 0.8;
        z-index: -2;
      }

      .auth-shell-inner {
        border-radius: 28px;
        padding: 1.2rem;
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(22px);
        box-shadow:
          0 20px 60px rgba(15, 23, 42, 0.18),
          0 0 0 1px rgba(148, 163, 184, 0.12);
      }

      .auth-grid {
        display: grid;
        grid-template-columns: minmax(0, 1.15fr) minmax(0, 1fr);
        gap: 1.4rem;
      }

      @media (max-width: 768px) {
        body {
          padding: 1.25rem;
        }
        .auth-shell-inner {
          padding: 1rem;
        }
        .auth-grid {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      /* ==== SIDE: intro / branding ==== */
      .auth-side {
        border-radius: 22px;
        padding: 1.5rem 1.6rem;
        background: radial-gradient(
            circle at top left,
            rgba(59, 130, 246, 0.22),
            transparent 55%
          ),
          radial-gradient(
            circle at bottom right,
            rgba(45, 212, 191, 0.18),
            transparent 45%
          ),
          linear-gradient(135deg, #1d4ed8, #0f766e);
        color: #e5e7eb;
        overflow: hidden;
        position: relative;
      }

      .auth-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.25rem 0.7rem;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.2);
        border: 1px solid rgba(209, 213, 219, 0.22);
        font-size: 0.75rem;
      }

      .auth-logo {
        width: 46px;
        height: 46px;
        border-radius: 16px;
        background: radial-gradient(circle at 30% 0, #facc15, #fb923c);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.35);
      }

      .auth-title {
        font-weight: 700;
        font-size: 1.4rem;
        margin-bottom: 0.15rem;
      }

      .auth-subtitle {
        font-size: 0.85rem;
        color: rgba(226, 232, 240, 0.9);
      }

      .auth-highlight {
        margin-top: 1rem;
        font-size: 0.82rem;
        line-height: 1.6;
      }

      .auth-highlight ul {
        padding-left: 1rem;
        margin-bottom: 0.75rem;
      }

      .auth-highlight li {
        margin-bottom: 0.2rem;
      }

      .auth-footer-note {
        font-size: 0.78rem;
        opacity: 0.85;
        margin-top: 1rem;
      }

      .auth-orbit {
        position: absolute;
        right: -40px;
        bottom: -40px;
        width: 170px;
        height: 170px;
        border-radius: 999px;
        border: 1px dashed rgba(191, 219, 254, 0.5);
        opacity: 0.4;
      }

      /* ==== CARD LOGIN ==== */
      .card-login {
        max-width: 460px;
        width: 100%;
        border-radius: 22px;
        box-shadow: 0 16px 45px rgba(15, 23, 42, 0.16);
        border: 1px solid var(--card-border);
        background: var(--card-bg);
        backdrop-filter: blur(14px);
        padding: 1.7rem 1.6rem 1.4rem;
      }

      @media (max-width: 768px) {
        .card-login {
          max-width: 100%;
          padding: 1.3rem 1.1rem 1.1rem;
        }
      }

      .card-login h4 {
        font-weight: 700;
        letter-spacing: 0.03em;
      }

      .brand-pill {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.2rem 0.6rem;
        border-radius: 999px;
        background: var(--primary-soft);
        font-size: 0.72rem;
        color: #1d4ed8;
        font-weight: 500;
      }

      .text-muted-soft {
        color: var(--muted);
        font-size: 0.82rem;
      }

      /* nav pills mode */
      #modeTabs .nav-link {
        border-radius: 999px;
        padding-inline: 1.2rem;
        font-weight: 500;
        font-size: 0.9rem;
        color: var(--muted);
        border: 1px solid transparent;
        transition: all 0.18s ease;
      }

      #modeTabs .nav-link.active {
        background: linear-gradient(135deg, var(--primary), var(--accent));
        color: #f9fafb;
        box-shadow: 0 10px 25px rgba(37, 99, 235, 0.35);
      }

      #modeTabs .nav-link:not(.active):hover {
        background: rgba(226, 232, 240, 0.7);
        border-color: rgba(148, 163, 184, 0.6);
        color: #1f2933;
      }

      /* input field style */
      .form-label {
        font-size: 0.83rem;
        font-weight: 500;
        color: #111827;
      }

      .field-shell {
        position: relative;
      }

      .field-icon {
        position: absolute;
        left: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        font-size: 0.9rem;
        opacity: 0.55;
        pointer-events: none;
      }

      .field-shell .form-control {
        padding-left: 2.1rem;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.8);
        font-size: 0.9rem;
        transition: border-color 0.15s ease, box-shadow 0.15s ease,
          background 0.15s ease;
      }

      .field-shell .form-control:focus {
        border-color: rgba(37, 99, 235, 0.9);
        box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.2),
          0 10px 24px rgba(37, 99, 235, 0.16);
        background: #ffffff;
      }

      .toggle-password {
        position: absolute;
        right: 0.65rem;
        top: 50%;
        transform: translateY(-50%);
        border: none;
        background: transparent;
        font-size: 0.85rem;
        color: var(--muted);
        cursor: pointer;
      }

      .toggle-password:hover {
        color: #111827;
      }

      /* primary button micro interaction */
      #primaryBtn {
        border-radius: 999px;
        font-weight: 600;
        font-size: 0.95rem;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        border: none;
        box-shadow: 0 12px 35px rgba(37, 99, 235, 0.45);
        transform: translateY(0) scale(1);
        transition: transform 0.14s ease, box-shadow 0.14s ease,
          filter 0.14s ease;
      }

      #primaryBtn:not(:disabled):hover {
        transform: translateY(-1px) scale(1.02);
        filter: brightness(1.05);
      }

      #primaryBtn:disabled {
        opacity: 0.85;
        box-shadow: 0 6px 18px rgba(148, 163, 184, 0.5);
      }

      .helper-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.78rem;
        color: var(--muted);
        margin-top: 0.35rem;
      }

      .helper-row a {
        text-decoration: none;
        font-weight: 500;
        color: #2563eb;
      }

      .helper-row a:hover {
        text-decoration: underline;
      }

      /* error text */
      #loginError {
        font-size: 0.8rem;
      }

      /* Toast status bottom */
      .status-toast {
        position: fixed;
        left: 50%;
        bottom: 1.7rem;
        transform: translateX(-50%) translateY(18px);
        opacity: 0;
        transition: all 0.25s ease;
        z-index: 1050;
        pointer-events: none;
      }

      .status-toast.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }

      .status-toast-inner {
        display: inline-flex;
        align-items: center;
        gap: 0.55rem;
        padding: 0.55rem 1.05rem;
        border-radius: 999px;
        font-size: 0.83rem;
        box-shadow: 0 12px 32px rgba(15, 23, 42, 0.5);
        border: 1px solid rgba(148, 163, 184, 0.55);
        backdrop-filter: blur(10px);
        background: radial-gradient(
            circle at top left,
            rgba(59, 130, 246, 0.35),
            transparent
          ),
          rgba(15, 23, 42, 0.98);
        color: #e5e7eb;
      }

      .status-toast-success .status-toast-inner {
        background: radial-gradient(
            circle at top left,
            rgba(34, 197, 94, 0.3),
            transparent
          ),
          rgba(15, 23, 42, 0.98);
      }

      .status-toast-error .status-toast-inner {
        background: radial-gradient(
            circle at top left,
            rgba(239, 68, 68, 0.32),
            transparent
          ),
          rgba(15, 23, 42, 0.98);
      }

      .status-toast-icon {
        font-size: 1rem;
      }
    </style>
  </head>

  <body>
    <div class="auth-shell">
      <div class="auth-shell-bg"></div>

      <div class="auth-shell-inner">
        <div class="auth-grid">
          <!-- LEFT: branding / intro -->
          <aside class="auth-side d-none d-md-flex flex-column justify-content-between">
            <div>
              <div class="auth-badge mb-3">
                <span>‚ú® Vocabulary Trainer</span>
                <span class="badge bg-light text-dark border-0">Beta</span>
              </div>

              <div class="d-flex align-items-center gap-3 mb-3">
                <div class="auth-logo">üìö</div>
                <div>
                  <div class="auth-title">‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</div>
                  <div class="auth-subtitle">
                    Sync ‡∏Å‡∏±‡∏ö Google Sheet ¬∑ Practice ¬∑ Quiz ¬∑ Stats
                  </div>
                </div>
              </div>

              <div class="auth-highlight">
                <div class="mb-1 fw-semibold small">‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö</div>
                <ul class="mb-2">
                  <li>‡πÄ‡∏î‡πá‡∏Å‡∏™‡∏≤‡∏¢‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå / ‡πÄ‡∏î‡πá‡∏Å‡∏´‡πâ‡∏≠‡∏á Eng Program</li>
                  <li>‡∏ï‡∏¥‡∏ß‡∏™‡∏≠‡∏ö GAT / TU-GET / IELTS Vocabulary</li>
                  <li>‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏°‡∏µ ‚Äú‡∏Ñ‡∏•‡∏±‡∏á‡∏®‡∏±‡∏û‡∏ó‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‚Äù ‡πÅ‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏±‡∏á</li>
                </ul>
                <div class="small">
                  ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏≥ list ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏ù‡∏∂‡∏Å‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô
                </div>
              </div>
            </div>

            <div class="auth-footer-note">
              Tip: ‡∏•‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢ import CSV ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ
            </div>

            <div class="auth-orbit"></div>
          </aside>

          <!-- RIGHT: login card -->
          <div class="d-flex justify-content-center align-items-center">
            <div class="card card-login w-100">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div>
                  <h4 class="mb-1">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà Vocabulary Trainer</h4>
                  <p class="text-muted-soft mb-0">
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡∏¥‡∏á‡∏Å‡πå‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                  </p>
                </div>
              </div>

              <ul class="nav nav-pills mb-3 justify-content-center" id="modeTabs">
                <li class="nav-item">
                  <button
                    class="nav-link active"
                    type="button"
                    data-mode="login"
                    onclick="switchMode('login')"
                  >
                    Login
                  </button>
                </li>
                <li class="nav-item">
                  <button
                    class="nav-link"
                    type="button"
                    data-mode="register"
                    onclick="switchMode('register')"
                  >
                    Register
                  </button>
                </li>
              </ul>

              <div class="mb-3">
                <label class="form-label">Username</label>
                <div class="field-shell">
                  <span class="field-icon">üë§</span>
                  <input
                    id="loginUsername"
                    class="form-control"
                    autocomplete="username"
                  />
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label">Password</label>
                <div class="field-shell">
                  <span class="field-icon">üîí</span>
                  <input
                    id="loginPassword"
                    type="password"
                    class="form-control"
                    autocomplete="current-password"
                  />
                  <button
                    type="button"
                    class="toggle-password"
                    onclick="togglePassword()"
                    aria-label="Toggle password visibility"
                  >
                    üëÅ
                  </button>
                </div>
              </div>

              <div class="mb-3" id="displayNameGroup" style="display: none">
                <label class="form-label">Display name (‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á)</label>
                <div class="field-shell">
                  <span class="field-icon">‚ú®</span>
                  <input
                    id="displayName"
                    class="form-control"
                    placeholder="‡πÄ‡∏ä‡πà‡∏ô Beam, Mint, ‡πÄ‡∏î‡πá‡∏Å‡∏´‡πâ‡∏≠‡∏á 3/2"
                  />
                </div>
              </div>

              <div class="helper-row mb-2">
                <span>Tip: ‡∏à‡∏≥ username/password ‡πÉ‡∏´‡πâ‡∏î‡∏µ ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ô‡∏∞ üòÖ</span>
              </div>

              <div class="d-grid gap-2 mb-1">
                <button
                  id="primaryBtn"
                  class="btn d-flex align-items-center justify-content-center gap-2"
                  onclick="submitForm()"
                >
                  <span id="primaryBtnLabel">Login</span>
                  <div
                    id="primaryBtnSpinner"
                    class="spinner-border spinner-border-sm text-light d-none"
                    role="status"
                  >
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </button>
              </div>

              <div
                id="loginError"
                class="text-danger small mt-2"
                style="display: none"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
    <div
      id="statusToast"
      class="status-toast status-toast-success"
      style="display: none"
    >
      <div class="status-toast-inner">
        <span id="statusToastIcon" class="status-toast-icon">‚úÖ</span>
        <span id="statusToastText">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span>
      </div>
    </div>

    <script>
      // ‡πÉ‡∏ä‡πâ URL ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö app.js
      const API_URL =
        "https://script.google.com/macros/s/AKfycbxF2M9zo8CGTEeHpmNJJtm0yAdg2VzDdQvpqqNBD0pNgS51NjseavEdsfieXt5tyu0bzg/exec";

      let currentMode = "login"; // 'login' | 'register'

      function switchMode(mode) {
        currentMode = mode;

        document
          .querySelectorAll("#modeTabs .nav-link")
          .forEach((btn) =>
            btn.classList.toggle(
              "active",
              btn.getAttribute("data-mode") === mode
            )
          );

        const dnGroup = document.getElementById("displayNameGroup");
        const primaryBtnLabel = document.getElementById("primaryBtnLabel");
        const errorBox = document.getElementById("loginError");
        errorBox.style.display = "none";
        errorBox.textContent = "";

        if (mode === "register") {
          dnGroup.style.display = "block";
          primaryBtnLabel.textContent = "Register";
        } else {
          dnGroup.style.display = "none";
          primaryBtnLabel.textContent = "Login";
        }
      }

      // toggle show/hide password
      function togglePassword() {
        const input = document.getElementById("loginPassword");
        if (!input) return;
        input.type = input.type === "password" ? "text" : "password";
      }

      // ‡∏•‡πâ‡∏≤‡∏á prefix "Error: " ‡∏à‡∏≤‡∏Å Apps Script
      function cleanErrorMessage(msg) {
        if (!msg) return "";
        return String(msg).replace(/^Error:\s*/i, "");
      }

      function showError(msg) {
        const el = document.getElementById("loginError");
        const cleaned = cleanErrorMessage(msg);
        el.textContent = cleaned;
        el.style.display = "block";
        showToast(cleaned, "error");
      }

      // Toast helper
      function showToast(message, type = "success") {
        const toast = document.getElementById("statusToast");
        const icon = document.getElementById("statusToastIcon");
        const text = document.getElementById("statusToastText");

        if (!toast || !icon || !text) return;

        text.textContent = message;
        icon.textContent = type === "success" ? "‚úÖ" : "‚ö†Ô∏è";

        toast.classList.remove("status-toast-success", "status-toast-error");
        toast.classList.add(
          type === "success" ? "status-toast-success" : "status-toast-error"
        );

        toast.style.display = "block";

        requestAnimationFrame(() => {
          toast.classList.add("show");
        });

        setTimeout(() => {
          toast.classList.remove("show");
          setTimeout(() => {
            toast.style.display = "none";
          }, 250);
        }, 2500);
      }

      // Loading state ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° + form
      function setLoading(isLoading) {
        const btn = document.getElementById("primaryBtn");
        const label = document.getElementById("primaryBtnLabel");
        const spinner = document.getElementById("primaryBtnSpinner");
        const inputs = document.querySelectorAll("input");

        if (!btn || !label || !spinner) return;

        if (isLoading) {
          btn.disabled = true;
          inputs.forEach((i) => (i.disabled = true));

          label.textContent =
            currentMode === "login"
              ? "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö..."
              : "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å...";
          spinner.classList.remove("d-none");
        } else {
          btn.disabled = false;
          inputs.forEach((i) => (i.disabled = false));

          label.textContent = currentMode === "login" ? "Login" : "Register";
          spinner.classList.add("d-none");
        }
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô login
      async function submitLogin() {
        const username = document
          .getElementById("loginUsername")
          .value.trim();
        const password = document
          .getElementById("loginPassword")
          .value.trim();

        if (!username || !password) {
          showError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å username ‡πÅ‡∏•‡∏∞ password");
          return;
        }

        setLoading(true);

        try {
          const payload = {
            action: "login",
            username,
            password,
          };

          const res = await fetch(API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "text/plain;charset=utf-8",
            },
            body: JSON.stringify(payload),
          });

          if (!res.ok) {
            showError("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (" + res.status + ")");
            return;
          }

          const json = await res.json();
          if (!json.success) {
            showError(json.error || "‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            return;
          }

          localStorage.setItem("vt_user", JSON.stringify(json.user));
          showToast("‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Vocabulary‚Ä¶", "success");

          setTimeout(() => {
            window.location.href = "app.html";
          }, 600);
        } catch (err) {
          console.error(err);
          showError("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
        } finally {
          setLoading(false);
        }
      }

      async function submitRegister() {
        const username = document
          .getElementById("loginUsername")
          .value.trim();
        const password = document
          .getElementById("loginPassword")
          .value.trim();
        const displayName = document
          .getElementById("displayName")
          .value.trim();

        if (!username || !password) {
          showError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å username ‡πÅ‡∏•‡∏∞ password");
          return;
        }

        if (!displayName) {
          showError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Display name ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£");
          return;
        }

        setLoading(true);

        try {
          const payload = {
            action: "register",
            username,
            password,
            displayName,
          };

          const res = await fetch(API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "text/plain;charset=utf-8",
            },
            body: JSON.stringify(payload),
          });

          if (!res.ok) {
            showError("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (" + res.status + ")");
            return;
          }

          const json = await res.json();
          if (!json.success) {
            showError(json.error || "‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            return;
          }

          showToast("‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß üéâ", "success");

          // ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÇ‡∏´‡∏°‡∏î login ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
          switchMode("login");
          document.getElementById("loginPassword").value = "";
          document.getElementById("displayName").value = "";
        } catch (err) {
          console.error(err);
          showError("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
        } finally {
          setLoading(false);
        }
      }

      // ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏°‡∏≤‡∏™‡πå)
      function submitForm() {
        if (currentMode === "login") {
          submitLogin();
        } else {
          submitRegister();
        }
      }

      // ‡∏Å‡∏î Enter
      document.addEventListener("keydown", (e) => {
        if (e.key !== "Enter") return;

        const ae = document.activeElement;
        const isInput =
          ae &&
          (ae.tagName === "INPUT" ||
            ae.tagName === "TEXTAREA" ||
            ae.isContentEditable);

        if (!isInput) return;

        e.preventDefault();
        if (currentMode === "login") {
          submitLogin();
        } else {
          submitRegister();
        }
      });

      // ‡∏ñ‡πâ‡∏≤ login ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ app ‡πÄ‡∏•‡∏¢
      (function () {
        try {
          const u = JSON.parse(localStorage.getItem("vt_user") || "null");
          if (u && u.id) {
            window.location.href = "app.html";
          }
        } catch (e) {}
      })();
    </script>
  </body>
</html>
